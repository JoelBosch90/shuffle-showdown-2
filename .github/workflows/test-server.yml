# This workflow triggers when code is added to the staging branch.
# It runs tests for the server components on a clean ubuntu image.

name: Test Server

on:
  push:
    branches: [ "staging" ]
  pull_request:
    branches: [ "staging" ]

jobs:
  build:
    runs-on: ubuntu-latest
    container: golang:1.24-bullseye

    steps:
    - uses: actions/checkout@v4
    # Note that AWS CDK uses a JSII layer that requires Node.
    - uses: actions/setup-node@v4
      with:
        node-version: '22.x'
    - run: ./commands.sh build server

  test:
    runs-on: ubuntu-latest
    needs: build

    steps:
    - run: ./commands.sh test server
